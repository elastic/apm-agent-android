plugins {
    id 'com.android.library'
    id 'co.elastic.apm.dependency.embedder'
}

android {
    namespace = "co.elastic.apm.android.sdk"
    compileSdk androidCompileSdk
    buildFeatures.buildConfig true

    defaultConfig {
        minSdk androidMinSdk
        targetSdk androidCompileSdk

        buildConfigField("String", "APM_AGENT_VERSION", "\"${project.version}\"")

        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
        consumerProguardFiles "../shared-rules.pro"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility jvmCompatibility
        targetCompatibility jvmCompatibility
    }
}

licensesConfig {
    manualMappingFile = rootProject.file("manual_licenses_map.txt")
}

dependencies {
    api "io.opentelemetry:opentelemetry-api:$openTelemetry_version"
    api "io.opentelemetry:opentelemetry-sdk:$openTelemetry_version"
    api "io.opentelemetry:opentelemetry-api-events:$openTelemetry_version-alpha"
    api "com.squareup.okhttp3:okhttp:$okhttp_version"
    api 'org.stagemonitor:stagemonitor-configuration:0.89.1'
    implementation "androidx.lifecycle:lifecycle-process:2.5.1"
    implementation 'com.blogspot.mydailyjava:weak-lock-free:0.18'
    implementation project(':android-common')
    implementation "io.opentelemetry:opentelemetry-exporter-otlp:$openTelemetry_version"
    implementation "io.opentelemetry:opentelemetry-semconv:$openTelemetry_version-alpha"
    implementation "androidx.annotation:annotation:$androidAnnotations_version"
    implementation 'com.dslplatform:dsl-json-java8:1.10.0'
    embedded 'com.github.instacart.truetime-android:library:3.5'
    annotationProcessor 'co.elastic.apm.compile:processor'
    compileOnly 'co.elastic.apm.compile:processor'
    testImplementation "org.mockito:mockito-core:$mockito_version"
    testImplementation "org.mockito:mockito-inline:$mockito_version"
    testImplementation "junit:junit:$junit_version"
    androidTestImplementation 'androidx.test:runner:1.4.0'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'
}